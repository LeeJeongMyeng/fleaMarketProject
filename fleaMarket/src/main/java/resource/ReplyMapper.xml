<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   <mapper namespace="fleaMarket.a03_dao.ReplyDao">
     <!-- 부 모댓글 쓰기 -->
     <insert id = "replyWrite" parameterType = "reply">
         INSERT INTO REPLY values(replys_seq.nextval,#{communityNumber},#{email},#{repcontent},0,0,#{groupId},sysdate)
     </insert>
     <!-- groupId를 구하기 위함. -->
     <select id = "replyMax" resultType = "int">
          SELECT max(replyno) FROM REPLY
     </select>
     <update id = "replyCheck" parameterType = "reply">
         update reply set groupId = #{groupId} where Replyno != #{groupId}
     </update>
     <!-- 댓글 리스트 가져오기 -->
     <select id="replyList" resultType="reply">
	SELECT
	r.replyNo,r.COMMUNITYNUMBER,r.groupid,r.repclass,r.repcontent
	,f.NICKNAME,p.PROFILEIMG FROM REPLY r,FLEAMARKETMEMBER f,CAPPLICAION
	c,PROFILE p
	WHERE f.EMAIL = c.EMAIL AND c.COMMUNITYNUMBER =
	r.COMMUNITYNUMBER AND
	f.EMAIL = p.EMAIL
	and r.COMMUNITYNUMBER =
	#{communityNumber}
	ORDER BY groupid ASC,groupOrderid DESC
</select>
<!-- 답글 달기 -->
      <insert id = "rereplyWrite">
          INSERT INTO REPLY values(replys_seq.nextval,#{communityNumber},#{email},#{repcontent},1,0,#{groupId},sysdate) 
      </insert>

   </mapper>